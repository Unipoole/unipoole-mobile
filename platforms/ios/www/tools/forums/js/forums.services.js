"use strict";synthMobile.factory("ForumService",["$q","DataService","UserSession","LoggerService",function(e,t,n,s){function o(){}s("ForumService");return o.prototype._getData=function(){return t.getMergedToolData(n.activeModule,"forums")},o.prototype.getForums=function(){return this._getData()},o.prototype.getForum=function(e){return this._getData().then(function(t){return t[e]})},o.prototype.getDiscussion=function(e,t){return this.getForum(e).then(function(e){return e.discussions[t]})},o.prototype.getMessage=function(e,t,n){return this.getDiscussion(e,t).then(function(e){return e.messages[n]})},o.prototype.replyOnMessage=function(s,o,r){function i(e){var i={},c=moment().toISOString(),a=t.generateUID(),g={id:a,topic:r.topic,content:r.message,depth:e.depth+1,url:null,parent:e.id,status:"READY",attachments:null,create_date:c,creator_name:n.username,creator_id:n.lms_id,discussion_id:o,group_size:0,site_id:n.activeModule,attachment_count:0,reply_count:0};i[s]={},i[s].discussions={},i[s].discussions[o]={},i[s].discussions[o].messages={},i[s].discussions[o].messages[a]=g,t.mergeToToolData(n.activeModule,"forums",i,!0).then(function(){u.resolve()},function(e){u.reject(e)})}var u=e.defer(),c=this;return r.messsageId?c.getMessage(s,o,r.messsageId).then(function(e){i(e)},function(e){u.reject(e)}):c.getDiscussion(s,o).then(function(e){i(e)},function(e){u.reject(e)}),u.promise},new o}]);