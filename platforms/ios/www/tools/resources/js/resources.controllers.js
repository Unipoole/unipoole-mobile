"use strict";synthMobile.controller("ResourcesCtrl",["$scope","$filter","$rootScope","$window","ResourcesService","DataService","SynthErrorHandler",function(o,e,n,t,r,i,s){function a(e){r.getDirectChildren(e).then(function(e){o.resources=e.sort(function(o,e){return o.directory&&e.directory||!o.directory&&!e.directory?o.name<e.name?-1:o.name>e.name?1:0:o.directory&&!e.directory?-1:1})})}function c(o){a(null==o.state?null:o.state.id)}n.activePage="forums",n.breadcrumbs=[{name:"Resources"}],o.parentResource=null;var l=null;i.getDataDirectory("resources").then(function(o){l=o.nativeURL}),o.goUp=function(){window.history.back()},o.showInfo=function(e,n){n.stopPropagation(),o.resourceInfo=e,o.myScroll.mainScroll.scrollTo(0,0),$("#infoModal").modal("show")},o.openResource=function(o){if(o.directory)history.pushState(o,"Resources","#/tool/resources"),a(o.id);else if(o.isDownloaded){var e=function(e){window.plugins.fileOpener.open({path:e,mimeType:o.mime_type},function(){},function(o){alert(o)})};"text/url"==o.mime_type?i.getFileContentCDV(o.downloadPath).then(function(o){e(o)},s):e(l+o.treeId)}},o.downloadResource=function(o,e){e&&e.stopPropagation(),o.busyDownloading=!0,r.downloadResource(o).then(function(e){o.busyDownloading=!1,o.isDownloaded=e.isDownloaded,o.downloadPath=e.downloadPath},function(e){o.busyDownloading=!1,console.log(e)},function(e){e instanceof ProgressEvent&&(o.downloadProgress=e.lengthComputable?e.loaded/e.total*100:e.loaded/o.size*100)})},window.addEventListener("popstate",c),o.$on("$destroy",function(){window.removeEventListener("popstate",c)}),a(null)}]);