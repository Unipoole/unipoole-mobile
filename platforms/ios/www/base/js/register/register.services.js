"use strict";synthMobile.factory("RegisterService",["$q","$filter","DataService","SyncAPIService","LoggerService","SynthFail","SynthCheckResponseError","SynthQLoop",function(e,t,r,o,n,i,u,a){function l(){}var c=n("RegisterService");return l.prototype.initModules=function(e){function t(){return o==e.length?null:r._createModuleStructure(e[o++].id)}c.debug("initModules()");var r=this,o=0;return a(t)},l.prototype.registerModules=function(e){function t(){if(n==e.length)return null;var t=e[n++];return o.registerForModule(t.id).then(function(e){var t={lmsId:e.userDetails["lms-id"],displayName:e.userDetails["display-name"]};return r.mergeToRegistrationData(t)}).then(function(){return o.updateModuleData(t.id)})}var n=0;return a(t)},l.prototype._createModuleStructure=function(e){function t(){if(i==o.length)return null;var t=o[i++];return n._createToolDataFile(e,t.id)}function r(){return n._getModuleTools(e).then(function(e){o=e})}var o,n=this,i=0;return this._createModuleDataFile(e).then(r).then(a(t))},l.prototype._createModuleDataFile=function(e){return r.copyFromWebToFile("base/data/module.json",e,"module.json")},l.prototype._createToolDataFile=function(e,t){return r.writeToFile(e+"/tools/"+t+"/data",t+".json","{}")},l.prototype._getModuleTools=function(o){var n=e.defer();return r.getModuleData(o).then(function(e){var r=t("object2Array")(e.toolsLocal);c.isDEBUG()&&c.debug("Got module tools : "+JSON.stringify(r)),n.resolve(r)},function(e){n.reject(e)}),n.promise},new l}]);