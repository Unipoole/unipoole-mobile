"use strict";synthMobile.factory("LoggerService",["$q","$log","$injector","SynthConfig","SynthQLoop",function(n,e,o,t,r){function i(){var e=n.defer();return y===!0?e.resolve():document.addEventListener("deviceready",function(){y=!0,e.resolve()},!1),e.promise}function c(){return i().then(function(){function o(n){n.root.getDirectory(t.dataDir,{create:!0,exclusive:!1},function(n){i.resolve(n)},r)}function r(n){e.warn("Failed to get filesystem, code:"+n.code),i.reject(n)}var i=n.defer();return window.requestFileSystem(LocalFileSystem.PERSISTENT,0,o,r),i.promise}).then(function(e){var o=n.defer();return e.getDirectory("logs",{create:!0},function(n){o.resolve(n)}),o.promise})}function u(e){return c().then(function(o){var t=n.defer();return o.getFile(e,{create:!0},function(n){t.resolve(n)},function(n){deferred.reject(n)}),t.promise})}function f(){var e=n.defer();return u("log."+R+".txt").then(function(n){n.remove(function(){e.resolve()},function(n){e.reject(n)})}),e.promise}function s(e){function o(n){t.reject(n)}var t=n.defer();return u("log."+e+".txt").then(function(n){n.getParent(function(r){n.moveTo(r,"log."+(e+1)+".txt",function(n){t.resolve(n)},o)},o)}),t.promise}function l(){function n(){return 0>o?null:s(o--)}function e(){return u("log.0.txt")}var o=R-1;return f().then(function(){return r(n)}).then(e)}function a(){l().then(function(n){return n})}function d(o){u("log.0.txt").then(function(t){function r(n){n.onwriteend=function(){c.resolve()},n.seek(n.length),n.write(o+"\n")}function i(n){e.warn("Failed while trying to write to file, error: "+n),deferred.reject(n)}var c=n.defer();return t.createWriter(r,i),c.promise})}function w(n){this.name=n}var m={},g={DEBUG:1,INFO:2,WARN:3,ERROR:4,NONE:5},v=t.logLevel,p=t.logToConsole,h=t.logToFile,R=t.logFileCount,y=!1;w.prototype.debug=function(n){if(this.isDEBUG()){var o=moment().format("YYYY-MM-DD HH:mm:ss")+" "+this.name+" (DEBUG) : "+n;p&&e.log(o),h&&d(o)}},w.prototype.warn=function(n){if(this.isWARN()){var o=moment().format("YYYY-MM-DD HH:mm:ss")+" "+this.name+" (WARN) : "+n;p&&e.warn(o),h&&d(o)}},w.prototype.info=function(n){if(this.isINFO()){var o=moment().format("YYYY-MM-DD HH:mm:ss")+" "+this.name+" (INFO) : "+n;p&&e.info(o),h&&d(o)}},w.prototype.error=function(n){if(this.isERROR()){var o=moment().format("YYYY-MM-DD HH:mm:ss")+" "+this.name+" (ERROR) : "+n;p&&e.error(o),h&&d(o)}},w.prototype.isERROR=function(){return v<=g.ERROR},w.prototype.isINFO=function(){return v<=g.INFO},w.prototype.isWARN=function(){return v<=g.WARN},w.prototype.isDEBUG=function(){return v<=g.DEBUG},w.prototype.levels=g;var Y=new w("SYSTEM");return window.console.log=function(n){Y.debug(n)},window.console.warn=function(n){Y.warn(n)},window.console.error=function(n){Y.error(n)},window.console.info=function(n){Y.info(n)},window.console.exception=window.console.log,window.console.trace=window.console.log,window.console.group=window.console.log,window.console.groupCollapsed=window.console.log,window.console.table=function(n){console.log("%o",n)},a(),function(n){return void 0===m[n]&&(m[n]=new w(n)),m[n]}}]);