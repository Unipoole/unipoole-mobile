"use strict";synthMobile.factory("ScheduleService",["$q","$filter","DataService","UserSession","SynthFail",function(e,t,r,n){function a(){}function o(e){var t=[];for(var r in e)i(t,e[r]);for(var n=0;n<t.length;n++)e[t[n].id]=t[n]}function i(e,t){switch(t.frequency){case"day":s(e,t,"days",1);break;case"MWF":s(e,t,"days",1,[1,3,5]);break;case"TT":s(e,t,"days",1,[2,4]);break;case"week":s(e,t,"weeks",1);break;case"month":s(e,t,"months",1);break;case"year":s(e,t,"years",1)}}function s(e,t,r,n,a){if(t.recurs_until)for(var o=moment(t.recurs_until),i=1;o.isAfter(moment(t.start).add(r,i*n));){var s=moment(t.start).add(r,i*n);if(!a||jQuery.inArray(s.day(),a)>-1){var u={};jQuery.extend(u,t),u.start=s.toDate(),u.end=moment(t.end).add(r,i*n).toDate(),u.id=t.id+"_"+i++,e.push(u)}}else for(var d=1,c=0;d<t.recurrence_count;c++){var f=moment(t.start).add(r,(c+1)*n);if(!a||jQuery.inArray(f.day(),a)>-1){var u={};jQuery.extend(u,t),u.start=f.toDate(),u.end=moment(t.end).add(r,(c+1)*n).toDate(),u.id=t.id+"_"+c,e.push(u),d++}}}return a.prototype.getAll=function(){return r.getToolData(n.activeModule,"schedule").then(function(e){return o(e),e})},a.prototype.getEvent=function(e){return this.getAll().then(function(t){return t[e]})},new a}]);