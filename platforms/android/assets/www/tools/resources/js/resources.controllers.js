"use strict";synthMobile.controller("ResourcesCtrl",["$scope","$filter","$rootScope","$window","$timeout","ResourcesService","DataService","SynthErrorHandler",function(o,e,n,t,r,i,s,c){function l(e){o.loadingResources=!0,r(function(){i.getDirectChildren(e).then(function(e){var n=e.sort(function(o,e){return o.directory&&e.directory||!o.directory&&!e.directory?o.name<e.name?-1:o.name>e.name?1:0:o.directory&&!e.directory?-1:1});o.loadingResources=!1,o.resources=n})},500)}function a(o){l(null==o.state?null:o.state.id)}n.activePage="forums",n.breadcrumbs=[{name:"Resources"}],o.showResourceInfo=!1,o.loadingResources=!0,o.parentResource=null;var u=null;s.getDataDirectory("resources").then(function(o){u=o.nativeURL}),o.goUp=function(){window.history.back()},o.showInfo=function(e,n){n.stopPropagation(),o.resourceInfo=e,o.myScroll.mainScroll.scrollTo(0,0),o.showResourceInfo=!0},o.hideInfo=function(){o.myScroll.mainScroll.scrollTo(0,0),o.showResourceInfo=!1},o.openResource=function(o){if(o.directory)history.pushState(o,"Resources","#/tool/resources"),l(o.id);else if(o.isDownloaded){var e=function(e){window.plugins.fileOpener.open({path:e,mimeType:o.mime_type},function(){},function(o){alert(o)})};"text/url"==o.mime_type?s.getFileContentCDV(o.downloadPath).then(function(o){e(o)},c):e(u+o.treeId)}},o.downloadResource=function(o,e){e&&e.stopPropagation(),o.busyDownloading=!0,i.downloadResource(o).then(function(e){o.busyDownloading=!1,o.isDownloaded=e.isDownloaded,o.downloadPath=e.downloadPath},function(e){o.busyDownloading=!1,console.log(e)},function(e){e instanceof ProgressEvent&&(o.downloadProgress=e.lengthComputable?e.loaded/e.total*100:e.loaded/o.size*100)})},window.addEventListener("popstate",a),o.$on("$destroy",function(){window.removeEventListener("popstate",a)}),l(null)}]);