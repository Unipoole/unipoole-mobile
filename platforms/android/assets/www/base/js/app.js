"use strict";var synthMobile=angular.module("SynthMobile",["ngRoute","ngAnimate","ab-base64","ui.bootstrap","frapontillo.bootstrap-switch","ng-iscroll"]).config(["$routeProvider","$compileProvider",function(t,n){n.imgSrcSanitizationWhitelist(/^\s*(https?|ftp|file|cdvfile):|data:image\//),t.when("/boot",{templateUrl:"base/partials/boot.html",controller:"BootCtrl"}).when("/boot/:moduleId",{templateUrl:"base/partials/boot.html",controller:"BootCtrl"}).when("/home",{templateUrl:"base/partials/toolSelect.html",controller:"HomeCtrl"}).when("/settings",{templateUrl:"base/partials/settings.html",controller:"SettingsCtrl"}).when("/settings-sync",{templateUrl:"base/partials/settings-sync.html",controller:"SettingsSyncCtrl"}).when("/settings-chooseModules",{templateUrl:"base/partials/selectModules.html",controller:"SettingsSelectModulesCtrl"}).when("/sync",{templateUrl:"base/partials/sync.html",controller:"SyncCtrl"}).when("/sync-configure",{templateUrl:"base/partials/sync-configure.html",controller:"SyncConfigureCtrl"}).when("/sync-progress",{templateUrl:"base/partials/sync-progress.html",controller:"SyncProgressCtrl"}).when("/register",{templateUrl:"base/partials/login.html",controller:"RegisterCtrl"}).when("/register-selectModules",{templateUrl:"base/partials/selectModules.html",controller:"RegisterSelectModuleCtrl"}).when("/register-modulesRegistration",{templateUrl:"base/partials/registerModules.html",controller:"RegisterModuleRegistrationCtrl"}).otherwise({redirectTo:"/boot"})}]).factory("SynthQLoop",["$q",function(t){return function(n){function e(){var t=n();null==t?r.resolve():t.then(e,function(t){r.reject(t)})}var r=t.defer();return{then:function(t,n,o){return e(),r.promise.then(t,n,o)},notify:function(){console.log("need to update")}}}}]).factory("SynthQIfStatement",["$q",function(t){return function(n,e,r){var o=t.defer();return n().then(function(t){var n=t?e:r;return null==n?void o.resolve():void n().then(function(){o.resolve()},function(t){o.reject(t)})},function(t){o.reject(t)}),o.promise}}]).factory("UserSession",[function(){return{username:null,authToken:null,deviceId:null,modules:{},registered:!1,activeModule:null,updateSession:function(t){for(var n in t)this[n]=t[n]},clearSession:function(){for(var t in this)"function"!=typeof this[t]&&(this[t]=null)}}}]).factory("SynthError",["$http",function(t){var n={};return t({method:"GET",url:"base/data/errorMessages.json"}).success(function(t){n=t}).error(function(){}),function(t,e){if(t instanceof Error){var r=angular.copy(n[1e3]);return r.additional=t.message,r}if("object"==typeof t)return{id:t.errorCode,errorMessage:t.message,errorInstruction:t.instruction,additional:e};var r=angular.copy(n[t]);return e&&(r.additional=e),r}}]).factory("SynthFail",[function(){return function(t){return function(n){t.reject(n)}}}]).factory("SynthCheckResponseError",["SynthError","LoggerService","DataService","UserSession",function(t,n,e,r){var o=n("SynthCheckResponseError");return function(n,a){if(2002===a.errorCode){var i={authToken:null};r.updateSession(i),e.mergeToRegistrationData(i)}return void 0===a.status?!1:"SUCCESS"===a.status?!1:(o.isWARN()&&o.warn("Got error response : "+JSON.stringify(a)),null!=n&&n.reject(t(a)),!0)}}]).factory("SynthErrorHandler",["$q","$rootScope","SynthError",function(t,n,e){return function(r){return r instanceof Error&&(r=e(r)),n.synthError=r,$("#synthErrorModal").modal("show"),t.reject(r)}}]).factory("AppSyncStatus",["$rootScope",function(){return{inSync:!1,tools:{},allOutSync:function(){this.inSync=!1,this.tools={}},update:function(t,n){null==n?this.inSync=!1:(this.tools=this.tools||{},this.tools[n]=this.tools[n]||{},this.tools[n].inSync=t)},updateTools:function(t){this.tools=null==t?{}:t}}}]).factory("SynthAuthenticateUser",["$q","UserSession","SyncAPIService","$rootScope",function(t,n,e,r){return{FAILED:"1",SUCCESS:"0",CANCELLED:"2",login:function(o,a){function i(){r.authenticationModel=null,r.authenticationOk=null,r.authenticationCancelled=null}var l=t.defer();return null!=n.authToken?(l.resolve({code:0,username:n.username,authToken:n.authToken}),l.promise):(r.authenticationModel={username:n.username,password:null,authFailed:!1,message:null,instruction:null,submitText:a?a:"Authenticate",titleText:o?o:"Please enter password"},r.authenticationOk=function(){e.authenticateUser(r.authenticationModel.username,r.authenticationModel.password).then(function(t){t.authenticated?($("#synthAuthenticationModal").modal("hide"),n.authToken=t.authToken,l.resolve({code:0,username:r.authenticationModel.username,password:r.authenticationModel.password}),i()):(r.authenticationModel.message=t.message,r.authenticationModel.instruction=t.instruction,r.authenticationModel.password=null,r.authenticationModel.authFailed=!0)},function(t){$("#synthAuthenticationModal").modal("hide"),i(),l.reject(t)})},r.authenticationCancelled=function(){$("#synthAuthenticationModal").modal("hide"),i(),l.resolve({code:2})},$("#synthAuthenticationModal").modal("show"),l.promise)}}}]).filter("noEscape",["$sce",function(t){return function(n){return t.trustAsHtml(n)}}]).filter("object2Array",function(){return function(t){var n=[];for(var e in t){var r=t[e];r.key=e,n.push(r)}return n}}).filter("array2Object",function(){return function(t,n){var e={};n=n||"id";for(var r=0;r<t.length;r++){var o=t[r];e[o[n]]=o}return e}}).filter("formatDate",function(){return function(t,n){return n||(n="YYYY-MM-DD h:mm a"),null===t||""===t?"":moment(t).format(n)}}).filter("bytesToSize",function(){return function(t,n){var e=["B","KB","MB","GB","TB"];if(n&&0===t)return"0";if(void 0===t||0===t)return"n/a";var r=parseInt(Math.floor(Math.log(t)/Math.log(1024)));return 0===r?t+" "+e[r]:(t/Math.pow(1024,r)).toFixed(1)+" "+e[r]}}).filter("attachments",function(){return function(t){var n=[];for(var e in t){var r=t[e];r.link===!1&&n.push(r)}return n}}).controller("AppController",["$scope","$routeParams","$window","UserSession","UserService","SynthConfig","AppSyncStatus","SyncService",function(t,n,e,r,o,a,i,l){function s(){l.stopBackgroundSync()}function u(){l.startBackgroundSync()}t.linkVendor=function(){window.open(a.vendorURL,"_system")},t.vendorName=a.vendorName,t.applicationName=a.applicationName,t.userSession=r,t.appSyncStatus=i,document.addEventListener("pause",s,!1),document.addEventListener("resume",u,!1),t.myScrollOptions=t.myScrollOptions||{},t.myScrollOptions.menuScroll={scrollbars:!0},t.goBack=function(){"home"===t.activePage||"register"===t.activePage||"boot"===t.activePage?"iOS"!==device.platform&&navigator.notification.confirm("Are you sure you want to exit the application?",function(t){2===t&&navigator.app.exitApp()},"Exit Application",["No","Yes"]):navigator.app.backHistory()},document.addEventListener("backbutton",function(){t.goBack()},!1)}]),SynthAttachmentMiner={addHandler:function(t,n){null==this.handlers&&(this.handlers={}),null==this.handlers[t]&&(this.handlers[t]="string"==typeof n&&"default"===n?this.defaultHandler:n)},getHandler:function(t){return null==this.handlers?null:this.handlers[t]},parseArray:function(t,n){var e=[];if(t)for(var r=0;r<t.length;r++)null!=t[r].downloadKey&&(t[r].downloadPath=n+"/"+t[r].downloadPath,e.push(t[r]));return e},defaultHandler:function(t,n){var e=[];for(var r in t)e=e.concat(SynthAttachmentMiner.parseArray(t[r].attachments,n));return e}},SynthEmbeddedImageHandler={addHandler:function(t,n){null==this.handlers&&(this.handlers={}),null==this.handlers[t]&&(this.handlers[t]=n)},getHandler:function(t){return null==this.handlers?null:this.handlers[t]},fixForHtmlElement:function(t,n){var e=$("<div/>").html(t);return e.find("img").each(function(){$(this).attr("src",n+"/"+$(this).attr("src"))}),e.html()}},SynthUploadResponseHandler={addHandler:function(t,n){null==this.handlers&&(this.handlers={}),null==this.handlers[t]&&(this.handlers[t]=n)},getHandler:function(t){return null==this.handlers?null:this.handlers[t]}},SynthLinkHandler={addHandler:function(t,n){null==this.handlers&&(this.handlers={}),null==this.handlers[t]&&(this.handlers[t]=n)},getHandler:function(t){return null==this.handlers?null:this.handlers[t]},fixContent:function(t){var n=$("<div/>").html(t);return n.find("a[href]").each(function(){var t=$(this).attr("href");$(this).attr("href","javascript:window.open('"+t+"', '_system');")}),n.html()}};